<!DOCTYPE html>
<html lang="en">
<head>

  <!-- Basic Page Needs
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta charset="utf-8">
  <title>Only Links</title>
  <meta name="description" content="">
  <meta name="author" content="">

  <!-- Mobile Specific Metas
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- FONT
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@200;300;400;500;600;900&display=swap" rel="stylesheet">
 
  <!-- CSS
    –––––––––––––––––––––––––––––––––––––––––––––––––– -->
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/skeleton.css">
    <link rel="stylesheet" href="profile.css">
    <link rel="stylesheet" href="tile.css">

  <!-- Favicon
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="icon" type="image/png" href="images/favicon.png">

  <!-- JS
    –––––––––––––––––––––––––––––––––––––––––––––––––– -->
    <script >
      
      function homePage(){
          window.open("index.html", "_self");
          console.log("switching to home page");
      }

      function gotoCreateTile() {
        window.open("createtile.html", "_self");
          console.log("switching to create tile page");
      }
      let file = {};
      function chooseFile(e){
        console.log("choosefileworking")
              file = e.target.files[0];
            }
      
          </script>

</head>
<body>
  <button id="okok">TEST</button>

  <!-- Primary Page Layout
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <div class="gohomeback" id="homenotloggedin">
    <button class="gohome" onclick="homePage()">&#8592 GO BACK</button>
    </div>
  <div class="container "> 
    <div class="row ">
      <div class="blank"></div>
      
      <div class="twelve columns">
        <img class="mainlogo"src="assets/logo-w.png" alt="">
      </div>

    </div>
    
    <div class="twelve columns " >

    <!-- login up form --------------------------->
    <div class="loginform" id="loginform" style="display: none;">
        <div class="title">Let's Login.</div>
        <div class="subtitle">Whats you special password? </div>

        <div class="input-container ic1">
          <input id="emailLogIn" class="input" type="email" placeholder=" " />
          <div class="cut"></div>
          <label for="email" class="placeholder">email</label>
        </div>

        <div class="input-container ic2">
          <input id="passwordLogIn" class="input" type="password" placeholder=" " />
          <div class="cut"></div>
          <label for="password" class="placeholder">password</label>
        </div>

        <button type="text" class="submit" id="loginSubmit">submit</button>
        <div class="subtitle2">NEW HERE?
          <button type="text" class="subtitle2btn" id="switchToSignUp" >SIGNUP!</button>
        </div>
        <div id="errormessageLogin" class = "errormessage">&#128519</div>
      </div>


      <!-- sign up form --------------------------->
      <div class="signupform" id="signupform" style="display: none;">
        <div class="title">Let's SignUp.</div>
        <div class="subtitle">Hop on the ship sir!</div>

        <div class="input-container ic1">
          <input id="emailSignUp" class="input" type="email" placeholder=" " />
          <div class="cut"></div>
          <label for="email" class="placeholder">email</label>
        </div>

        <div class="input-container ic2">
          <input id="passwordSignUp" class="input" type="password" placeholder=" " />
          <div class="cut"></div>
          <label for="password" class="placeholder">password</label>
        </div>
        

        <button type="text" class="submit" id="signupSubmit">NEXT</button>

        <div class="subtitle2">BEEN HERE?
          <button type="text" class="subtitle2btn" id="switchToLogIn" >LOGIN!</button>
        </div>
        <div id="errormessageSignup" class="errormessage">&#128519</div>

      </div>

       <!-- post sign up form --------------------------->
       <div class="signupform" id="postsignupform" style="display: none;">
        <div class="title">A Bit More.</div>
        <div class="subtitle">What should we call you?</div>

        <div class="input-container ic1">
          <input id="usernamePostSignUp" class="input" type="text" placeholder=" " />
          <div class="cut"></div>
          <label for="usernamePostSignUp" class="placeholder">username</label>
        </div>
        

        <button type="text" class="submit" id="postSignUpSubmit">submit</button>

      </div>

      <!-- post login --------------------------->
      
      </div>

      <div class="twelve columns ">
      <div class="four columns ">
        <div class="logoutform centertext" id="logoutform" style="display: none;">
          <div class="title">Hello.</div>
          <img class="userphotobig" src="assets/modidp.jpeg" alt="">
          <div class="subtitle">Welcome back!, <div id="username" style="display:inline-block">ddhereusername</div></div>
          <div class="subtitle" >mail: <div id="usermail" style="display:inline-block;">eDE@d.com</div> </div>
  
          <button type="text" class="submit" id="profileMoreBtn">MORE</button>
      </div>

      <div id="profilemore" class="logoutform" style="display: none;"  style="display: none;">
        <button type="text" class="submit" id="updateprofilebtn">UPDATE PROFILE</button>
        <!-- <button type="text" class="submit" onclick="gotoCreateTile()">CREATE TILE</button> -->
        <button type="text" class="submit" id="logoutSubmit">LOGOUT</button>
        <button type="text" class="submit" id="backtoProfileBtn">BACK</button>

      </div>

      <div class="logoutform centertext" id="updateprofile" style="display: none;">
        <div class="title">Update Things.</div>

        <div class="photochangediv">
          <img class="userphotobigchange" src="assets/modidp.jpeg" alt="">
          <button class="userphotochangebtn" id="changePhotoBtn">change</button>
        </div>

        <div class="subtitle" >username: <div id="username2"  style="display:inline-block;" >ddhereusername</div> </div>
        <button class = "usernamechangebtn" id="changeUsernameBtn">change</button>
          <button type="text" class="submit" id="backToMoreBtn">BACK</button>
        </div>
        
        <div class="logoutform" id="changeusernameform" style="display: none;">
          <div class="title">Enter New Username.</div>
          <div class="input-container ic1">
            <input id="newusername" class="input" type="text" placeholder=" " />
            <div class="cut"></div>
            <label for="email" class="placeholder">username</label>
          </div>
          <button type="text" class="submit" id="submitUsernameChange">SUBMIT</button>
          <button type="text" class="submit" id="dontChangeUsernameBtn">BACK</button>
      </div>

      <div class="logoutform" id="changephotoform" style="display: none;">
        <div class="title">Upload New Photo.</div>
        <input type="file" onchange="chooseFile(event)" id="fileUploader">
          <button type="text" class="submit" id="submitPhotoChange">SUBMIT</button>
          <button type="text" class="submit" id="dontChangePhotoBtn">BACK</button>
      </div>
      
      
      


    </div>
      <div class="eight columns favsection" id="favsection" style="display: none;">
        <div class="favsheading">Saved Tiles.</div>
        
          <div class="favscroll">

          <div
          class="seven columns tile card"
          id="cardtemplate"
          style="display: display"
        >
          <div class="cardhaibc" id="cardhaibc">
            <div class="tileheader" >
              <div class="userphotobox" >
                <img class="userphoto" src="assets/modidp.png" alt="" />
                
                
                <div class="blank"></div>

                <h6>
                  gene:-&nbsp
                  <p class="creatorname">CDH10</p>
                </h6>
                <br />
                <h6>
                  tileid:-&nbsp#
                  <p class="tilehash">#dbid1</p>
                </h6>
              
                <div class="blank"></div>
                <img class="userphoto2" onclick="savecard(this)" src="assets/save.png" alt="" />
              </div>
            </div>
            <div class="tilecontent">
              <br />
              <h2 class="tiletitle" style="font-size: 20px">.</h2>
              <p style="font-size:16px;font-weight:600">Disease Class:-&nbsp<p class="tilelink1">.</p> </p>
              <br/>
              <p style="font-size:16px;font-weight:600">PID:-&nbsp<p class="tilelink2">.</p> </p>
              <br/>
              <p style="font-size:16px;font-weight:600">Year:-&nbsp<p class="tilelink3">.</p> </p>
              <br/>
              <p style="font-size:16px;font-weight:600">Lackasso:-&nbsp<p class="tilelink4">.</p> </p>
              <br/>
              <p style="font-size:16px;font-weight:600">NCBI:-&nbsp<a href="#" class="tilelink6">Click Here</a></p>
              <br/>
              <p style="font-size:16px;font-weight:600">ENSEMBL:-&nbsp<a href="#" class="tilelink9">Click Here</a></p>
              <br/>
              <p style="font-size:16px;font-weight:600">GO:-&nbsp<a href="#"class="tilelink7">Ontology</a>&nbsp|&nbsp<a href="#"class="tilelink8">Gene Products</a></p>
              <br/>
              
              <p style="font-size:16px;font-weight:600">Conclusion:-&nbsp<p class="tilelink5">..</p> </p>
              <br/>
              <div class="contentendspacer"></div>
            </div>
          </div>

          
        </div>
          </div>

      </div>
    </div>
   

<!-- End Document––––––––––––––––––––––––––––––––––––––––––––––––––-->


<script src="linkScript.js"></script>
<script type="module">
  // Import the functions you need from the SDKs you need
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.5.0/firebase-app.js";
import { getDatabase,get, ref, set, child, update, remove} from "https://www.gstatic.com/firebasejs/9.5.0/firebase-database.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut} from "https://www.gstatic.com/firebasejs/9.5.0/firebase-auth.js";
import { getStorage, uploadBytes} from "https://www.gstatic.com/firebasejs/9.5.0/firebase-storage.js";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyAzhLY6fU0Vss7XcOnUey_-Pqh88xJEvjw",
  authDomain: "alzdb-fafcd.firebaseapp.com",
  databaseURL: "https://alzdb-fafcd-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "alzdb-fafcd",
  storageBucket: "alzdb-fafcd.appspot.com",
  messagingSenderId: "252793865531",
  appId: "1:252793865531:web:93de525d5b423bc818231e",
  measurementId: "G-CVRQ5P78RW"
};


// Initialize Firebase
const app = initializeApp(firebaseConfig);
const db= getDatabase(app);
const auth = getAuth();

var loginBtn = document.getElementById('loginSubmit');
var signupBtn = document.getElementById('signupSubmit');
var logoutBtn = document.getElementById('logoutSubmit');
var postsignupBtn = document.getElementById('postSignUpSubmit');
var switchToSignUpBtn = document.getElementById("switchToSignUp");
var switchToLogInBtn = document.getElementById("switchToLogIn");
var switchToLogInBtn = document.getElementById("switchToLogIn");
var moreBtn = document.getElementById('profileMoreBtn');
var backtoProfileBtn = document.getElementById('backtoProfileBtn');
var updateProfileBtn = document.getElementById('updateprofilebtn');
var backToMoreBtn = document.getElementById('backToMoreBtn');
var changeUsernameBtn = document.getElementById('changeUsernameBtn');
var changePhotoBtn = document.getElementById('changePhotoBtn');
var dontChangeUsernameBtn = document.getElementById('dontChangeUsernameBtn');
var dontChangePhotoBtn = document.getElementById('dontChangePhotoBtn');
var submitUsernameChange = document.getElementById("submitUsernameChange");
var submitPhotoChange = document.getElementById("submitPhotoChange");

var currentUser;
var currentUserUsername;
var currentUserId; 

var loginform = document.getElementById("loginform");
var signupform = document.getElementById("signupform");
var logoutform = document.getElementById("logoutform");
var profilemore = document.getElementById("profilemore");
var updateprofile = document.getElementById("updateprofile");
var changeusernameform = document.getElementById("changeusernameform");
var changephotoform = document.getElementById("changephotoform");




      var okok = document.getElementById("okok")
      okok.addEventListener('click', searchFavs);
      var favArr=[0,1,2,3,4,5,6,7,8,9];
      console.log(favArr);
      function searchFavs() {
        var counter = 0;
        favArr = [];
        const dbref = ref(db);
        var tempcurrentuser = auth.currentUser;
        var tempcurrentuserid = tempcurrentuser.uid;
        console.log(tempcurrentuserid);
        //for (let i = 0; i < 100; i++) {
          get(child(dbref, "userfavs/" + tempcurrentuserid)).then((snapshot) => {
            if (snapshot.exists()) {
              
              snapshot.forEach(function (childSnapshot) {
                const item = childSnapshot.val();
                favArr[counter]=item;
                counter = counter + 1;
              });
            } else {
              console.log("No data available");
            }
          });
          console.log(favArr);
        //}
      } 

      function cloneCard() {
        var template = document.getElementById("cardtemplate");
        var template2 = document.getElementById("cardspacer");
        template.style.display = "block";
        template2.style.display = "block";
        var newClone = $("#cardtemplate").clone();
        var newSpacer = $("#cardspacer").clone();
        template.style.display = "none";
        template2.style.display = "none";

        var tempid = "card" + (cardcount + 1);
        newClone.find("#cardhaibc").attr("id", tempid);

        if (cardcount % 3 == 1) {
          newSpacer.appendTo("#cardholder");
          newClone.appendTo("#cardholder");
        }
        if (cardcount % 3 == 2) {
          newSpacer.appendTo("#cardholder");
          newClone.appendTo("#cardholder");
        }
        if (cardcount % 3 == 0) {
          newClone.appendTo("#cardholder");
        }
        cardcount++;
        console.log(cardcount);
        return tempid;
      }

      function generateCards(...args) {
        console.log("generateCards function is called here");
        // 0 = conclusion
        // 1 = column1
        // 2 = dbid
        // 3 = disclass
        // 4 = gene
        // 5 = lackasso
        // 6 = pid
        // 7 = title
        // 8 = years

        var cardid;

        console.log("this is search resealt array"+searchResultArr)
        searchResultArr.forEach(function (element) {
          cardid = cloneCard();
          var card = document.getElementById(cardid);
          var title = card.getElementsByClassName("tiletitle")[0];
          var tilelink1 = card.getElementsByClassName("tilelink1")[0];
          var tilelink2 = card.getElementsByClassName("tilelink2")[0];
          var tilelink3 = card.getElementsByClassName("tilelink3")[0];
          var tilelink4 = card.getElementsByClassName("tilelink4")[0];
          var tilelink5 = card.getElementsByClassName("tilelink5")[0];
          var tilelink6 = card.getElementsByClassName("tilelink6")[0];
          var tilelink7 = card.getElementsByClassName("tilelink7")[0];
          var tilelink8 = card.getElementsByClassName("tilelink8")[0];
          var tilelink9 = card.getElementsByClassName("tilelink9")[0];
          var tileid = card.getElementsByClassName("tilehash")[0];
          var gene = card.getElementsByClassName("creatorname")[0];
          var temp = "maindata/";
          temp = temp.concat(element);
          const dbref = ref(db);
          get(child(dbref, temp)).then((snapshot) => {
            console.log("ret from fb")
            console.log(snapshot.val())
            tileid.innerText = snapshot.val().DB_ID;
            gene.innerText = snapshot.val().GENE;
            title.innerText = snapshot.val().TITLE;
            tilelink1.innerText = snapshot.val().DIS_CLASS;
            tilelink2.innerText = snapshot.val().PUBMED_ID;
            tilelink3.innerText = snapshot.val().YEAR;
            tilelink4.innerText = snapshot.val().LACKASSO;
            tilelink5.innerText = snapshot.val().CONCLUSION;
            var tempncbiterm = snapshot.val().GENE;
            var tempncbilink = "https://www.ncbi.nlm.nih.gov/gene/?term=" + tempncbiterm
            console.log(tempncbilink);
            tilelink6.href = tempncbilink;
            var tempncbilink = "http://amigo.geneontology.org/amigo/search/ontology?q=" + tempncbiterm
            tilelink7.href = tempncbilink;
            var tempncbilink = "http://amigo.geneontology.org/amigo/search/bioentity?q=" + tempncbiterm
            tilelink8.href = tempncbilink;
            var tempncbilink = "http://asia.ensembl.org/Multi/Search/Results?q=" + tempncbiterm + ";site=ensembl"
            tilelink9.href = tempncbilink;
          
          });
        });
      }


window.onload = pageLoad;
function pageLoad(){
  onAuthStateChanged(auth, (user) => {
    
    if (user) {  

      const dbRef = ref(getDatabase());
      var tempusernamesearch = "users/" + user.uid
      console.log(tempusernamesearch)
      get(child(dbRef, tempusernamesearch)).then((snapshot) => {
      if (snapshot.exists()) {
        currentUserUsername = snapshot.val().username;
              console.log(snapshot.val().username);
          }
      loginform.style.display = "none";
      signupform.style.display = "none";
      logoutform.style.display = "block";
      updateLogout();
        });
      }
        else {
      loginform.style.display = "block";
      signupform.style.display = "none";
      logoutform.style.display = "none";
    }
  });
}



function switchToSignUp(){
  noerror();
  loginform.style.display = "none";
  signupform.style.display = "block";
}
function switchToLogIn(){
  noerror();
  loginform.style.display = "block";
  signupform.style.display = "none";
}


function login(){
    var email = document.getElementById("emailLogIn");
    var password = document.getElementById("passwordLogIn");

      signInWithEmailAndPassword(auth, email.value, password.value)
    .then((userCredential) => {
      // Signed in 
      const user = userCredential.user;
      console.log(user);
      // ...
      loginform.style.display = "none";
      signupform.style.display = "none";
      logoutform.style.display = "block";
    })
    .catch((error) => {
      const errorCode = error.code;
      const errorMessage = error.message;
      console.log(error.code)
      console.log("-----------------")
      console.log(error.message)
      var errorholder = document.getElementById("errormessageLogin")
      if (error.code=="auth/wrong-password"){
        errorholder.innerHTML= "Wrong Password &#129300"
      }
      if (error.code=="auth/user-not-found"){
        errorholder.innerHTML= "User Not Found &#128565"
      }
    });

  }
function signup(){
    var email = document.getElementById("emailSignUp").value;
    var password = document.getElementById("passwordSignUp").value;

    createUserWithEmailAndPassword(auth, email,password).then(cred => {
      console.log(cred.user);
      set(ref(db, 'users/' + cred.user.uid), {
    uid: cred.user.uid,
    email: cred.user.email
      });
      loginform.style.display = "none";
    signupform.style.display = "none";
    postsignupform.style.display = "block";
    logoutform.style.display = "none";
    }).catch((error) => {
      const errorCode = error.code;
      const errorMessage = error.message;
      console.log(error.code)
      console.log("-----------------")
      console.log(error.message)
      var errorholder = document.getElementById("errormessageSignup")
      if (error.code=="auth/email-already-in-use"){
        errorholder.innerHTML= "User Already Exists ☝️"
      }
    });
  }

  function noerror(){
    var errorholder = document.getElementById("errormessageSignup")
    errorholder.innerHTML= "&#128519"
    var errorholder = document.getElementById("errormessageLogin")
    errorholder.innerHTML= "&#128519"
    var email = document.getElementById("emailSignUp");
    var password = document.getElementById("passwordSignUp");
    email.value = "";
    password.value = "";
    var email = document.getElementById("emailLogIn");
    var password = document.getElementById("passwordLogIn");
    email.value = "";
    password.value = "";
  }

  function fillSignUpForm(){
    var username = document.getElementById("usernamePostSignUp");

    update(ref(db, 'users/' + currentUserId), {
    username: username.value
      });
      currentUserUsername = username.value;
      loginform.style.display = "none";
    signupform.style.display = "none";
    postsignupform.style.display = "none";
    logoutform.style.display = "block";
    updateLogout();
  }

  onAuthStateChanged(auth, (user) => {
    if (user) {      //logged in
      currentUser = auth.currentUser;
      currentUserId = user.uid;
      document.getElementById("favsection").style.display= "block";
      updateLogout();
      
    } else {  //logged out
      currentUser = "nouserloggedin";
      currentUserId = "0x00000";
      document.getElementById("favsection").style.display= "none";
    }
  });
  
  function updateLogout(){
     var email = currentUser.email; 
     var emailPlaceHolder = document.getElementById("usermail");
     var usernamePlaceHolder = document.getElementById("username");
     var usernamePlaceHolder2 = document.getElementById("username2");
     emailPlaceHolder.innerHTML = email;
     usernamePlaceHolder.innerHTML = currentUserUsername; 
     usernamePlaceHolder2.innerHTML = currentUserUsername; 
  }
  function updateNewUsername(){
    var username = document.getElementById("newusername");
    update(ref(db, 'users/' + currentUserId), {
    username: username.value
      });
      currentUserUsername = username.value;
      updateprofile.style.display = "block";
      changeusernameform.style.display = "none";
      updateLogout();
  }

  function logout(){
    signOut(auth).then(() => {
      console.log("Logged Out")
    // Sign-out successful.
    }).catch((error) => {
      console.log(error);
    });
    loginform.style.display = "block";
    signupform.style.display = "none";
    logoutform.style.display = "none";
    profilemore.style.display = "none";

}



function showMore() {
  logoutform.style.display = "none";
  profilemore.style.display = "block";
}
function dontShowMore() {
  logoutform.style.display = "block";
  profilemore.style.display = "none";
}

function updateProfile() {
  profilemore.style.display = "none";
  updateprofile.style.display = "block";
  updateLogout();
}
function dontUpdateProfile() {
  profilemore.style.display = "block";
  updateprofile.style.display = "none";
}

function updateUsername() {
  updateprofile.style.display = "none";
  changeusernameform.style.display = "block";
}
function dontUpdateUsername() {
  updateprofile.style.display = "block";
  changeusernameform.style.display = "none";
}

function updatePhoto() {
  updateprofile.style.display = "none";
  changephotoform.style.display = "block";
}
function dontUpdatePhoto() {
  updateprofile.style.display = "block";
  changephotoform.style.display = "none";
}


loginBtn.addEventListener("click",login);
signupBtn.addEventListener("click",signup);
logoutBtn.addEventListener("click",logout);
postsignupBtn.addEventListener("click",fillSignUpForm);

switchToSignUpBtn.addEventListener("click",switchToSignUp);
switchToLogInBtn.addEventListener("click",switchToLogIn);

moreBtn.addEventListener("click",showMore);
backtoProfileBtn.addEventListener("click",dontShowMore);
updateProfileBtn.addEventListener("click",updateProfile);
backToMoreBtn.addEventListener("click",dontUpdateProfile);

changeUsernameBtn.addEventListener("click",updateUsername);
dontChangeUsernameBtn.addEventListener("click",dontUpdateUsername);

changePhotoBtn.addEventListener("click",updatePhoto);
dontChangePhotoBtn.addEventListener("click",dontUpdatePhoto);

submitUsernameChange.addEventListener("click",updateNewUsername)
submitPhotoChange.addEventListener("click",submitNewPhoto)
function submitNewPhoto() {
  console.log(file)
  var storage = getStorage();
  var uidd = currentUserId;
  uidd = uidd.concat("/profile.png");
  console.log(uidd)
  var storageRef = ref(storage, uidd);
  storageRef.put(file);
}

</script>

<script>
  function createcard(){
      
      if (cardcount%3==1){

        if (cardcount!=1){
          $('#cardspacer').clone().appendTo('#cardholder');
          $('#cardtemplate').clone().appendTo('#cardholder');
        }
        else {
          $('#cardtemplate').clone().appendTo('#cardholder');
        }
      
    }
    if (cardcount%3==2){
      $('#cardspacer').clone().appendTo('#cardholder');
      $('#cardtemplate').clone().appendTo('#cardholder');
    }
    if (cardcount%3==0){
      $('#cardtemplate').clone().appendTo('#cardholder');
    }
    cardcount++;
    console.log(cardcount)
    }
</script>


</body>
</html>